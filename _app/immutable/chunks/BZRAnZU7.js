import"./DsnmJJEf.js";import{i as ft}from"./BTGwZlOP.js";import{o as mt,s as X}from"./DUppubXp.js";import{ay as vt,az as ht,V as pt,T as yt,h as xt,g as R,aA as bt,a2 as _t,ai as ot,aj as kt,X as Mt,ax as St,Y as wt,t as e,Z as Et,a3 as Lt,_,z as E,$ as j,a0 as D,a4 as L}from"./BoqFzqd8.js";import{r as Y}from"./DSVHy22u.js";import{b as zt}from"./DJtt0LSM.js";import{p as C}from"./CHZKq16r.js";import{c as At,a as Tt,g as Wt}from"./C9-is0gv.js";import"./B2nU15ES.js";import{s as nt}from"./CsbEx7zF.js";import{s as Rt}from"./DBryx5vg.js";function N(a,n,z=n){var S=new WeakSet;vt(a,"input",async f=>{var i=f?a.defaultValue:a.value;if(i=F(a)?I(i):i,z(i),R!==null&&S.add(R),await ht(),i!==(i=n())){var H=a.selectionStart,p=a.selectionEnd,u=a.value.length;if(a.value=i??"",p!==null){var c=a.value.length;H===p&&p===u&&c>u?(a.selectionStart=c,a.selectionEnd=c):(a.selectionStart=H,a.selectionEnd=Math.min(p,c))}}}),(xt&&a.defaultValue!==a.value||pt(n)==null&&a.value)&&(z(F(a)?I(a.value):a.value),R!==null&&S.add(R)),yt(()=>{var f=n();if(a===document.activeElement){var i=bt??R;if(S.has(i))return}F(a)&&f===I(a.value)||a.type==="date"&&!f&&!a.value||f!==a.value&&(a.value=f??"")})}function F(a){var n=a.type;return n==="number"||n==="range"}function I(a){return a===""?null:+a}var jt=Mt('<div class="controls"><label> <input type="range" min="5" max="60"/></label> <label> <input type="range" min="-3000" max="0" step="10"/></label> <label> <input type="range" min="2" max="200"/></label> <label> <input type="range" min="1" max="100"/></label></div> <svg class="svelte-562cbf"></svg>',1);function Ot(a,n){_t(n,!1);let z=C(n,"markovStates",24,()=>[]),S=C(n,"markovTransitions",24,()=>[]),f=C(n,"mStartingStates",24,()=>[]),i=C(n,"endState",24,()=>[]),H=Wt(),{graphHeight:p,padding:u}=H,c=100,m=E(),s=E(15),B=E(-200),G=E(60),Z=E(22),k=[],it=S(),w=E(),v,V;function ct(){const r=c-2*u,A=p-2*u,y=new Map;S().forEach(l=>{y.has(l.from)||y.set(l.from,[]),y.get(l.from).push(l.to)}),v=new Map;const x=["START"];for(v.set("START",0);x.length>0;){const l=x.shift(),d=y.get(l)||[];for(const b of d)v.has(b)||(v.set(b,(v.get(l)??0)+1),x.push(b))}console.log("lev:",v),V=Math.max(...v.values());const M=new Map;z().forEach(l=>{const d=v.get(l)??V;M.has(d)||M.set(d,[]),M.get(d).push(l)}),console.log("grp",M),k=z().map(l=>{const d=v.get(l)??V,b=M.get(d)||[],T=b.indexOf(l),W=d/(V+.5)*A,t=r/(b.length+1),o=(T+1)*t+u;return{id:l,x:o,y:W}})}function gt(){if(!e(m))return;const r=nt(e(m));r.selectAll(".content-group").remove();const A=new Map(k.map(t=>[t.id,t])),y=it.map(t=>({label:t.probability,source:A.get(t.from),target:A.get(t.to)})).filter(t=>!!(t.source&&t.target));console.log("nodeMap, resolvedEdges:",A,y);const x=r.append("g").attr("class","content-group");k.forEach(t=>{f().includes(t.id)?(t.fx=c/2,t.fy=e(s)*2):i().includes(t.id)?(t.fx=c/2,t.fy=p-e(s)*2):(t.fx=null,t.fy=null)}),L(w,Rt(k).on("tick",W)),r.call(At(x));const M=Tt(e(w),W,k);r.append("svg:defs");const l=r.append("defs");[{id:"arrow-black",color:"black"},{id:"arrow-blue",color:"lightgrey"}].forEach(({id:t,color:o})=>{l.append("marker").attr("id",t).attr("viewBox",[0,0,10,10]).attr("refX",7).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("fill",o)});const d=x.append("g").attr("stroke","black").selectAll("line").data(y).join("line").attr("stroke","grey").attr("stroke-width",t=>t.label*2),b=x.append("g").selectAll("text").data(y).join("text").attr("font-size",9).text(t=>t.label),T=x.append("g").selectAll("g").data(k,t=>t.id).join("g").call(M);T.append("circle").attr("r",e(s)).attr("stroke","black").attr("fill","lightblue").attr("fill",t=>i().includes(t.id)?"lightgreen":f().includes(t.id)?"lightgrey":"lightblue"),T.append("text").attr("text-anchor","middle").attr("dy",5).attr("font-size",9).text(t=>t.id);function W(){k.forEach(t=>{const o=e(s)+u,g=c-e(s)-u,h=e(s)+u,dt=p-e(s)-u;t.x=Math.max(o,Math.min(g,t.x)),t.y=Math.max(h,Math.min(dt,t.y))}),d.attr("x1",t=>{const o=t.target.x-t.source.x,g=t.target.y-t.source.y,h=Math.hypot(o,g);return t.source.x+o*e(s)/h}).attr("y1",t=>{const o=t.target.x-t.source.x,g=t.target.y-t.source.y,h=Math.hypot(o,g);return t.source.y+g*e(s)/h}).attr("x2",t=>{const o=t.target.x-t.source.x,g=t.target.y-t.source.y,h=Math.hypot(o,g);return t.target.x-o*e(s)/h}).attr("y2",t=>{const o=t.target.x-t.source.x,g=t.target.y-t.source.y,h=Math.hypot(o,g);return t.target.y-g*e(s)/h}).attr("stroke",t=>t.target.y>=t.source.y?"black":"lightgrey").attr("marker-end",t=>t.target.y>=t.source.y?"url(#arrow-black)":"url(#arrow-blue)"),b.attr("x",t=>(t.source.x+t.target.x)/2.01).attr("y",t=>(t.source.y+t.target.y)/2.02),T.attr("transform",t=>`translate(${t.x},${t.y})`)}W()}mt(()=>{c=e(m).clientWidth,ct(),gt();const r=()=>{c=e(m).clientWidth};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)}),ot(()=>e(w),()=>{e(w)&&(e(w),e(w).alpha(0).restart())}),ot(()=>(e(m),e(s)),()=>{e(m)&&nt(e(m)).selectAll("circle").attr("r",e(s))}),kt(),ft();var J=jt(),q=St(J),O=j(q),K=j(O),Q=_(K);Y(Q),D(O);var P=_(O,2),$=j(P),tt=_($);Y(tt),D(P);var U=_(P,2),et=j(U),at=_(et);Y(at),D(U);var rt=_(U,2),st=j(rt),lt=_(st);Y(lt),D(rt),D(q);var ut=_(q,2);zt(ut,r=>L(m,r),()=>e(m)),wt(()=>{X(K,`Node Radius: ${e(s)??""} `),X($,`Charge Strength: ${e(B)??""} `),X(et,`Link Distance: ${e(G)??""} `),X(st,`Node Collide: ${e(Z)??""} `)}),N(Q,()=>e(s),r=>L(s,r)),N(tt,()=>e(B),r=>L(B,r)),N(at,()=>e(G),r=>L(G,r)),N(lt,()=>e(Z),r=>L(Z,r)),Et(a,J),Lt()}export{Ot as M};
