import"./DsnmJJEf.js";import{i as G}from"./BTGwZlOP.js";import{o as P}from"./DUppubXp.js";import{a2 as q,aF as Z,Z as C,a3 as I,t as z,z as U,a4 as V}from"./BoqFzqd8.js";import{b as J}from"./DJtt0LSM.js";import{p as W}from"./CHZKq16r.js";import"./B2nU15ES.js";import{z as K,s as N}from"./CsbEx7zF.js";import{d as O}from"./B-ELdldP.js";import{s as Q}from"./DBryx5vg.js";const X=()=>typeof window<"u"&&window.innerWidth<=768;function $(){const s=X();return{graphHeight:300,nodeRadius:s?5:15,padding:s?1:20,markerBoxWidth:10,markerBoxHeight:10}}function mt(){const s=X();return{graphHeight:600,nodeRadius:s?10:15,padding:s?12:20,markerBoxWidth:10,markerBoxHeight:10}}function tt(s){return K().on("zoom",i=>s.attr("transform",i.transform))}function et(s,i,x){return O().on("start",(c,a)=>{c.active||s.alphaTarget(.3).restart(),a.fx=a.x,a.fy=a.y}).on("drag",(c,a)=>{a.fx=a.x=c.x,a.fy=a.y=c.y,i()}).on("end",(c,a)=>{const y=x.findIndex(H=>H.id===a.id);c.active||s.alphaTarget(0),y!==-1&&(x[y].fx=a.x,x[y].fy=a.y)})}var at=Z('<svg class="svelte-1pge8fn"></svg>');function pt(s,i){q(i,!1);let x=W(i,"fsmStates",24,()=>[]),c=W(i,"fsmTransitions",24,()=>[]),a=W(i,"acceptingStates",24,()=>[]),y=W(i,"startingStates",24,()=>[]);W(i,"weighted",8);let H=$(),{graphHeight:L,nodeRadius:v,padding:l,markerBoxWidth:Y,markerBoxHeight:j}=H,k=700,u=U(),h=[],B=[];function A(o){const r=new Map;o.forEach(e=>{r.has(e.from)||r.set(e.from,[]),r.get(e.from).push(e.to)});const n=new Map,g=["START"];for(n.set("START",0);g.length>0;){const e=g.shift(),w=r.get(e)||[];for(const f of w)n.has(f)||(n.set(f,n.get(e)+1),g.push(f))}return n}function F(o){const r=new Map;for(const[M,d]of o.entries())r.has(d)||r.set(d,[]),r.get(d).push(M);const n=Math.max(...o.values()),g=k-2*l,e=L-2*l,w=g/(n+1),f=new Map;for(const[M,d]of r.entries()){const b=e/(d.length+1),S=l+M*w;d.forEach((t,m)=>{const p=l+(m+1)*b;f.set(t,{x:S,y:p})})}return f}function _(){if(!z(u))return;const o=N(z(u));o.selectAll(".content-group").remove();const r=new Map(h.map(t=>[t.id,t])),n=B.map(t=>({label:t.label,source:r.get(t.from),target:r.get(t.to)})).filter(t=>!!(t.source&&t.target));console.log("nodeMap, resolvedEdges:",r,n);const g=A(c()),e=o.append("g").attr("class","content-group");Math.max(...g.values());const w=Q(h).on("tick",S);o.call(tt(e));const f=et(w,S,h);o.append("svg:defs").append("svg:marker").attr("id","arrowhead").attr("viewBox",[0,0,Y,j]).attr("refX",34).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("svg:path").attr("d","M 0 0 L 10 5 L 0 10 z");const M=e.append("g").attr("stroke","black").selectAll("line").data(n).join("line").attr("stroke","grey").attr("marker-end","url(#arrowhead)"),d=e.append("g").selectAll("text").data(n).join("text").attr("font-size",9).text(t=>t.label),b=e.append("g").selectAll("g").data(h,t=>t.id).join("g").call(f);b.append("circle").attr("r",v).attr("fill",t=>a().includes(t.id)?"lightgreen":y().includes(t.id)?"lightgrey":"lightblue").attr("stroke","black").attr("stroke-width",t=>a().includes(t.id)?3:.5),b.append("text").attr("text-anchor","middle").attr("dy",5).attr("font-size",9).text(t=>t.id);function S(){h.forEach(t=>{const m=v+l,p=k-v-l,E=v+l,T=L-v-l;t.x=Math.max(m,Math.min(p,t.x)),t.y=Math.max(E,Math.min(T,t.y))}),M.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y).attr("d",function(t){const m=t.target.x-t.source.x,p=t.target.y-t.source.y,E=Math.sqrt(m*m+p*p),T=m*t.target.radius/E,D=p*t.target.radius/E;return"M"+t.source.x+","+t.source.y+"L"+(t.target.x-T)+","+(t.target.y-D)}).attr("stroke",t=>t.target.x>=t.source.x?"black":"lightgrey"),d.attr("x",t=>(t.source.x+t.target.x)/2.01).attr("y",t=>(t.source.y+t.target.y)/2.02),b.attr("transform",t=>`translate(${t.x},${t.y})`)}S()}P(()=>{k=z(u).clientWidth;const o=A(c()),r=F(o);h=x().map(g=>{const e=r.get(g)||{x:k/2,y:L/2};return{id:g,x:e.x,y:e.y}}),B=c(),_();const n=()=>{k=z(u).clientWidth};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)}),G();var R=at();J(R,o=>V(u,o),()=>z(u)),C(s,R),I()}export{pt as F,et as a,tt as c,mt as g};
