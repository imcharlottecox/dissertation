import"../chunks/DsnmJJEf.js";import{i as j}from"../chunks/BTGwZlOP.js";import{o as B}from"../chunks/DUppubXp.js";import{a2 as H,X as q,Z as F,a3 as G,_ as I,$ as U,t as h,z as Z,a4 as J,a0 as K}from"../chunks/BoqFzqd8.js";import{b as O}from"../chunks/DJtt0LSM.js";import{i as Q}from"../chunks/B2nU15ES.js";import{s as V,z as tt}from"../chunks/CsbEx7zF.js";import{d as at}from"../chunks/B-ELdldP.js";import{s as et}from"../chunks/DBryx5vg.js";import{l as rt,m as ot,a as st}from"../chunks/BReedbPm.js";import{x as nt,y as it}from"../chunks/Dca5MbJk.js";var lt=q('<main><h1>My Finite State Machine!</h1> <svg class="svelte-1d42lzv"></svg></main>');function bt(w,z){H(z,!1);const k=["Cat","Car","Cart","Carton","Cats","Cars","Carts","Cartons","ACCEPT"],S=["START"],A=["START","C","Ca","Cat","Cats","Car","Cars","Cart","Carts","Carto","Carton","Cartons"],M=[{from:"START",to:"C",label:"C"},{from:"C",to:"Ca",label:"a"},{from:"Ca",to:"Cat",label:"t"},{from:"Ca",to:"Car",label:"r"},{from:"Cat",to:"ACCEPT",label:"END"},{from:"Cat",to:"Cats",label:"s"},{from:"Cats",to:"ACCEPT",label:"END"},{from:"Car",to:"ACCEPT",label:"END"},{from:"Car",to:"Cart",label:"t"},{from:"Car",to:"Cars",label:"s"},{from:"Cars",to:"ACCEPT",label:"END"},{from:"Cart",to:"ACCEPT",label:"END"},{from:"Cart",to:"Carts",label:"s"},{from:"Carts",to:"ACCEPT",label:"END"},{from:"Cart",to:"Carto",label:"o"},{from:"Carto",to:"Carton",label:"n"},{from:"Carton",to:"ACCEPT",label:"END"},{from:"Carton",to:"Cartons",label:"s"},{from:"Cartons",to:"ACCEPT",label:"END"}],C=600,u=20,c=20,L=10,D=10;let g=100,d=Z(),f=[],P=M;function N(){const r=g-2*c,n=A.length;f=A.map((e,i)=>{const o=c+i/(n-1)*r;let l;["START","C","Ca","Car","Cart"].includes(e)||e.startsWith("Carto")?l=C*.5:["Cat","Cats"].includes(e)?l=C*.7:["Cars","Carts"].includes(e)?l=C*.3:l=C*.5;const s=f.find(y=>y.id===e),x=s&&(s.fx!==o||s.fy!==l);return{id:e,x:x?s.fx:o,y:x?s.fy:l}})}function R(r){const n=new Map;r.forEach(o=>{n.has(o.from)||n.set(o.from,[]),n.get(o.from).push(o.to)});const e=new Map,i=["START"];for(e.set("START",0);i.length>0;){const o=i.shift(),l=n.get(o)||[];for(const s of l)e.has(s)||(e.set(s,e.get(o)+1),i.push(s))}return e}function W(){if(!h(d))return;const r=V(h(d));r.selectAll(".content-group").remove();const n=new Map(f.map(t=>[t.id,t])),e=P.map(t=>({label:t.label,source:n.get(t.from),target:n.get(t.to)})).filter(t=>!!(t.source&&t.target));console.log("nodeMap, resolvedEdges:",n,e);const i=r.append("g").attr("class","content-group"),o=tt().on("zoom",t=>{i.attr("transform",t.transform)});r.call(o),r.call(o.transform,Q);const l=at().on("start",(t,a)=>{t.active||y.alphaTarget(.3).restart(),a.fx=a.x,a.fy=a.y}).on("drag",(t,a)=>{a.fx=a.x=t.x,a.fy=a.y=t.y,E()}).on("end",(t,a)=>{const m=f.findIndex(p=>p.id===a.id);t.active||y.alphaTarget(0),m!==-1&&(f[m].fx=a.x,f[m].fy=a.y)}),s=R(M),x=Math.max(...s.values()),y=et(f).force("link",rt(e).id(t=>t.id).distance(75)).force("charge",ot().strength(-1e3)).force("center",st(g/2+2*c,300)).force("xLevel",nt(t=>{const a=s.get(t.id)??0;return S.includes(t.id)?g*.025:c+a/x*(g-2*c)}).strength(1)).force("ySpread",it(C/2)).alphaDecay(.09).on("tick",E);r.append("svg:defs").append("svg:marker").attr("id","arrowhead").attr("viewBox",[0,0,L,D]).attr("refX",42).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("svg:path").attr("d","M 0 0 L 10 5 L 0 10 z");const Y=i.append("g").attr("stroke","black").selectAll("line").data(e).join("line").attr("marker-end","url(#arrowhead)").attr("stroke","grey"),_=i.append("g").selectAll("text").data(e).join("text").attr("font-size",10).text(t=>t.label),v=i.append("g").selectAll("g").data(f,t=>t.id).join("g").call(l);v.append("circle").attr("r",u).attr("fill",t=>k.includes(t.id)?"lightgreen":"lightblue").attr("stroke","black").attr("stroke-width",t=>k.includes(t.id)?3:.5),v.append("text").attr("text-anchor","middle").attr("dy",5).attr("font-size",10).text(t=>t.id);function E(){f.forEach(t=>{const a=u+c,m=g-u-c,p=u+c,T=C-u-c;t.x=Math.max(a,Math.min(m,t.x)),t.y=Math.max(p,Math.min(T,t.y))}),Y.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y).attr("d",function(t){const a=t.target.x-t.source.x,m=t.target.y-t.source.y,p=Math.sqrt(a*a+m*m),T=a*t.target.radius/p,$=m*t.target.radius/p;return"M"+t.source.x+","+t.source.y+"L"+(t.target.x-T)+","+(t.target.y-$)}).attr("stroke",t=>t.target.x>=t.source.x?"grey":"blue"),_.attr("x",t=>(t.source.x+t.target.x)/2.01).attr("y",t=>(t.source.y+t.target.y)/2.02),v.attr("transform",t=>`translate(${t.x},${t.y})`)}E()}B(()=>{g=h(d).clientWidth,N(),W();const r=()=>{g=h(d).clientWidth};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)}),j();var b=lt(),X=I(U(b),2);O(X,r=>J(d,r),()=>h(d)),K(b),F(w,b),G()}export{bt as component};
